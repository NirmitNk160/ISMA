/* =====================================================
   ISMA ‚Äî ADD / EDIT PRODUCT FORM (FINAL FIXED)
   Responsive ‚Ä¢ Stable layout ‚Ä¢ Scan button fixed
   ===================================================== */


/* ================= ROOT ================= */

.add-product-root {
  min-height: 100vh;
  background: var(--app-bg);
  color: var(--text-primary);
  font-family: "Segoe UI", system-ui, sans-serif;
}

.add-product-body {
  display: flex;
}

/* MAIN CONTENT */

.add-product-content {
  flex: 1;
  padding: 40px 48px;
  max-width: 1100px;
  margin: 0 auto;
  width: 100%;
}


/* ================= HEADER ================= */

.page-header {
  display: flex;
  align-items: center;
  gap: 14px;
  margin-bottom: 28px;
}

.page-title {
  font-size: 26px;
  font-weight: 800;
  letter-spacing: 0.4px;
}


/* ================= CARD ================= */

.add-product-card {
  background: var(--card-bg-solid);
  border-radius: 26px;
  padding: 32px;
  border: 1px solid var(--border-color);
  box-shadow: var(--card-shadow);
}


/* ================= FORM GRID ================= */

.form-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 22px;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 6px;
  min-width: 0;
}

.form-group.full {
  grid-column: 1 / -1;
}


/* ================= LABELS ================= */

.form-group label {
  font-size: 13px;
  font-weight: 800;
  letter-spacing: 0.4px;
  color: var(--text-secondary);
  text-transform: uppercase;
}


/* ================= INPUT FIELDS ================= */

.form-group input,
.form-group textarea {
  padding: 14px 16px;
  border-radius: 14px;
  background: var(--input-bg);
  border: 1px solid var(--input-border);
  color: var(--text-primary);
  font-size: 15px;
  outline: none;
  width: 100%;
}

.form-group textarea {
  min-height: 110px;
  resize: vertical;
}

.form-group input:focus,
.form-group textarea:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-soft);
  background: var(--input-bg-focus);
}


/* =====================================================
   ‚≠ê BARCODE FIELD (MAIN FIX)
   ===================================================== */

.barcode-field {
  display: flex;
  align-items: stretch;
  gap: 12px;
  width: 100%;
  height:48px;
  margin-bottom: 55px;
}

.barcode-field input {
  flex: 1;
  min-width: 0;
}

/* SCAN BUTTON */

.scan-btn {
  display: flex;
  align-items: center;
  justify-content: center;

  padding: 0 20px;
  height: 48px;

  border-radius: 14px;
  border: none;
  cursor: pointer;

  font-size: 14px;
  font-weight: 800;
  letter-spacing: 0.4px;

  color: var(--text-invert);

  background: linear-gradient(
    135deg,
    var(--accent),
    var(--accent-strong)
  );

  white-space: nowrap;
  flex-shrink: 0;

  box-shadow: 0 10px 26px rgba(79, 70, 229, 0.35);
  transition: 0.2s ease;
}

.scan-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 14px 36px rgba(79, 70, 229, 0.55);
}


/* ================= FORM ACTIONS ================= */

.form-actions {
  display: flex;
  justify-content: flex-end;
  gap: 16px;
  margin-top: 32px;
}

.secondary-btn {
  background: transparent;
  border: 1px solid var(--border-color);
  color: var(--text-secondary);
  padding: 12px 22px;
  border-radius: 14px;
  font-weight: 700;
  cursor: pointer;
}

.secondary-btn:hover {
  background: var(--row-hover);
}

.primary-btn {
  background: linear-gradient(
    135deg,
    var(--accent),
    var(--accent-strong)
  );
  color: var(--text-invert);
  border: none;
  padding: 14px 28px;
  border-radius: 16px;
  font-weight: 900;
  cursor: pointer;
}


/* =====================================================
   RESPONSIVE FIXES
   ===================================================== */

/* Tablet */

@media (max-width: 900px) {
  .add-product-content {
    padding: 28px;
  }

  .form-grid {
    grid-template-columns: 1fr;
  }
}

/* Mobile ‚Äî scan button fix */

@media (max-width: 600px) {
  .barcode-field {
    flex-direction: column;
  }

  .scan-btn {
    width: 100%;
    height: 46px;
  }
}

/* Small phone */

@media (max-width: 480px) {
  .page-title {
    font-size: 22px;
  }

  .add-product-card {
    padding: 24px;
  }
}

import { useState, useEffect} from "react";
import { useNavigate } from "react-router-dom";

import api from "../../api/axios";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";
import BackButton from "../../components/BackButton";
import BarcodeScanner from "../../components/BarcodeScanner/BarcodeScanner";
import { fetchProductFromBarcode } from "../../utils/barcodeLookup";

import { useSettings } from "../../context/SettingsContext";
import { useCurrency } from "../../context/CurrencyContext";

import "./AddProduct.css";

export default function AddProduct() {
  const navigate = useNavigate();
  const { settings } = useSettings();
  const { rates } = useCurrency();

  const [form, setForm] = useState({
    name: "",
    brand: "",
    category: "",
    size: "",
    stock: "",
    price: "",
    cost_price: "",
    description: "",
    barcode: "",
    sku: "",
    image_url: "",
    min_stock: 5,
    expiry_date: "",
    supplier_id: "",
  });

  const [loading, setLoading] = useState(false);
  const [error, setError] = useState("");
  const [infoMsg, setInfoMsg] = useState(""); // ‚≠ê new
  const [showScanner, setShowScanner] = useState(false);
  const [suppliers, setSuppliers] = useState([]);

  useEffect(() => {
    api
      .get("/suppliers")
      .then((res) => setSuppliers(res.data))
      .catch(() => console.log("Supplier fetch failed"));
  }, []);

  const handleChange = (e) =>
    setForm({ ...form, [e.target.name]: e.target.value });

  const showInfo = (msg) => {
    setInfoMsg(msg);
    setTimeout(() => setInfoMsg(""), 4000);
  };

  /* ================= BARCODE SCAN ================= */
  const handleScan = async (code) => {
    setShowScanner(false);

    try {
      const local = await api.get(`/inventory/barcode/${code}`);

      setForm((prev) => ({
        ...prev,
        ...local.data,
        barcode: code,
      }));

      showInfo("Product loaded from your inventory.");
      return;
    } catch {}

    const online = await fetchProductFromBarcode(code);

    if (online) {
      setForm((prev) => ({
        ...prev,
        ...online,
        barcode: code,
      }));

      showInfo("Product details fetched automatically.");
    } else {
      setForm((prev) => ({ ...prev, barcode: code }));

      showInfo(
        "Product details not found. Please enter manually ‚Äî it will auto-fill next time.",
      );
    }
  };

  /* ================= SUBMIT ================= */
  const handleSubmit = async (e) => {
    e.preventDefault();
    setError("");

    const priceInput = Number(form.price);
    const costInput = Number(form.cost_price || 0);
    const stockInput = Number(form.stock);

    if (priceInput < 0 || stockInput < 0 || costInput < 0) {
      setError("Stock and prices must be non-negative");
      return;
    }

    let priceInINR = priceInput;
    let costInINR = costInput;

    if (settings.currency !== "INR") {
      const rate = rates[settings.currency];

      if (!rate) {
        setError("Currency rate unavailable");
        return;
      }

      priceInINR = priceInput / rate;
      costInINR = costInput / rate;
    }

    setLoading(true);

    try {
      await api.post("/inventory", {
        ...form,
        stock: stockInput,
        price: Number(priceInINR.toFixed(2)),
        cost_price: Number(costInINR.toFixed(2)), // ‚≠ê IMPORTANT
      });

      navigate("/inventory");
    } catch (err) {
      setError(err.response?.data?.message || "Failed to add product");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="add-product-root">
      <Navbar />
      <div className="add-product-body">
        <Sidebar />

        <main className="add-product-content">
          <div className="page-header">
            <BackButton />
            <h2 className="page-title">Add Product</h2>
          </div>

          <form className="add-product-card" onSubmit={handleSubmit}>
            {error && <div className="error-msg">‚ùå {error}</div>}

            {infoMsg && <div className="info-msg">‚ÑπÔ∏è {infoMsg}</div>}

            <div className="form-grid">
              <div className="form-group">
                <label>Product Name</label>
                <input
                  name="name"
                  placeholder="Example: Sony Headphones WH-1000XM5"
                  value={form.name}
                  onChange={handleChange}
                  required
                />
              </div>

              <div className="form-group">
                <label>Brand</label>
                <input
                  name="brand"
                  placeholder="Sony, Samsung, Nike‚Ä¶"
                  value={form.brand}
                  onChange={handleChange}
                />
              </div>

              <div className="form-group">
                <label>Category</label>
                <input
                  name="category"
                  placeholder="Electronics, Grocery, Clothing‚Ä¶"
                  value={form.category}
                  onChange={handleChange}
                  required
                />
              </div>

              <div className="form-group">
                <label>Supplier</label>
                <select
                  name="supplier_id"
                  value={form.supplier_id}
                  onChange={handleChange}
                >
                  <option value="">Select Supplier</option>

                  {suppliers.map((s) => (
                    <option key={s.id} value={s.id}>
                      {s.name}
                    </option>
                  ))}
                </select>
              </div>

              <div className="form-group">
                <label>Size / Variant</label>
                <input
                  name="size"
                  placeholder="500ml, Large, 128GB‚Ä¶"
                  value={form.size}
                  onChange={handleChange}
                />
              </div>

              <div className="form-group">
                <label>Stock</label>
                <input
                  type="number"
                  name="stock"
                  placeholder="Available quantity"
                  value={form.stock}
                  onChange={handleChange}
                  required
                />
              </div>

              <div className="form-group">
                <label>Minimum Stock Alert</label>
                <input
                  type="number"
                  name="min_stock"
                  placeholder="Alert threshold (default 5)"
                  value={form.min_stock}
                  onChange={handleChange}
                />
              </div>

              <div className="form-group">
                <label>Expiry Date</label>
                <input
                  type="date"
                  name="expiry_date"
                  value={form.expiry_date}
                  onChange={handleChange}
                />
              </div>

              <div className="form-group">
                <label>Wholesale Price ({settings.currency})</label>
                <input
                  type="number"
                  name="cost_price"
                  placeholder={`Enter buying price in ${settings.currency}`}
                  value={form.cost_price}
                  onChange={handleChange}
                />
              </div>

              <div className="form-group">
                <label>Retail Price ({settings.currency})</label>
                <input
                  type="number"
                  placeholder={`Enter selling price in ${settings.currency}`}
                  name="price"
                  value={form.price}
                  onChange={handleChange}
                  required
                />
              </div>

              <div className="form-group">
                <label>SKU</label>
                <input
                  name="sku"
                  placeholder="Optional internal code"
                  value={form.sku}
                  onChange={handleChange}
                />
              </div>

              <div className="form-group">
                <label>Image URL</label>
                <input
                  name="image_url"
                  placeholder="Paste product image link"
                  value={form.image_url}
                  onChange={handleChange}
                />
              </div>

              {form.image_url && (
                <img src={form.image_url} className="product-preview" />
              )}

              <div className="form-group">
                <label>Barcode</label>
                <div className="barcode-field">
                  <input
                    name="barcode"
                    placeholder="Scan or enter barcode"
                    value={form.barcode}
                    onChange={handleChange}
                  />
                  <button
                    type="button"
                    className="scan-btn"
                    onClick={() => setShowScanner(true)}
                  >
                    üì∑ Scan
                  </button>
                </div>
              </div>

              <div className="form-group full">
                <label>Description</label>
                <textarea
                  name="description"
                  placeholder="Short product description (optional)"
                  value={form.description}
                  onChange={handleChange}
                />
              </div>
            </div>

            <div className="form-actions">
              <button
                type="button"
                className="secondary-btn"
                onClick={() => navigate("/inventory")}
              >
                Cancel
              </button>

              <button type="submit" className="primary-btn" disabled={loading}>
                {loading ? "Saving..." : "Save Product"}
              </button>
            </div>
          </form>

          {showScanner && (
            <div className="scanner-modal">
              <div className="scanner-box">
                <BarcodeScanner
                  onScan={handleScan}
                  onClose={() => setShowScanner(false)}
                />
              </div>
            </div>
          )}
        </main>
      </div>
    </div>
  );
}



Can we improve that select css?